{% extends "base.html" %}
{% load static %}

{% block content %}
  <main class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="h4 m-0">Products</h2>
      <div class="d-flex align-items-center">
        <span class="text-muted small me-3">Total: {{ total_products }}</span>
        <a class="btn btn-primary" href="{% url 'main:add_product' %}">Add</a>
      </div>
    </div>
    
    {% if user.is_authenticated and last_login %}
      <p class="text-muted small mb-3">Last login: {{ last_login }}</p>
    {% endif %}

    {% if products %}
      <div class="row g-3">
        {% for p in products %}
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm">
              {% if p.thumbnail %}
                <img src="{{ p.thumbnail }}" class="card-img-top" alt="{{ p.name }}">
              {% endif %}
              <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-start justify-content-between mb-2">
                  <h5 class="card-title mb-0">{{ p.name }}</h5>
                  {% if p.is_featured %}
                    <span class="badge badge-featured">Featured</span>
                  {% endif %}
                </div>
                <p class="card-text text-muted small flex-grow-1">{{ p.description|truncatechars:120 }}</p>
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <span class="badge text-bg-secondary">{{ p.category }}</span>
                  <span class="price">Rp{{ p.price }}</span>
                </div>
                <a class="btn btn-outline-secondary" href="{% url 'main:product_detail' pk=p.pk %}">Detail</a>
                {% if request.user.is_authenticated and p.user == request.user %}
                  <div class="d-flex gap-2 mt-2">
                    <a class="btn btn-outline-primary btn-sm" href="{% url 'main:product_edit' pk=p.pk %}">Edit</a>
                    <form method="post" action="{% url 'main:product_delete' pk=p.pk %}" onsubmit="return confirm('Delete this product?');">
                      {% csrf_token %}
                      <button class="btn btn-outline-danger btn-sm" type="submit">Delete</button>
                    </form>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="alert alert-info">
        No products yet.
      </div>
    {% endif %}
  </main>
{% endblock %}